// Copyright (c) 2025 Zack Puhl <github@xmit.xyz>. All rights reserved.
// Use of this source code is governed by the MIT license
// a copy of which can be found in the LICENSE_STDLIB file.
module sha3::turbo_shake_tests @test;

import sha3::tests_common;
import std::hash::sha3::turbo_shake;
import std::math;


// See: https://datatracker.ietf.org/doc/draft-irtf-cfrg-kangarootwelve/, section 5 (Test Vectors)
fn void turbo_shake_known_vectors() => @pool()
{
	char[] pattern = allocator::new_array(tmem, char, (usz)math::pow(17, 6) + 1);
	for (usz i = 0; i < pattern.len; ++i) pattern[i] = (char)(i % 0xFB);

	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 0)]), x"55cedd6f60af7bb29a4042ae832ef3f58db7299f893ebb9247247d856958daa9");
	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 1)]), x"9c97d036a3bac819db70ede0ca554ec6e4c2a1a4ffbfd9ec269ca6a111161233");
	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 2)]), x"96c77c279e0126f7fc07c9b07f5cdae1e0be60bdbe10620040e75d7223a624d2");
	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 3)]), x"d4976eb56bcf118520582b709f73e1d6853e001fdaf80e1b13e0d0599d5fb372");
	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 4)]), x"da67c7039e98bf530cf7a37830c6664e14cbab7f540f58403b1b82951318ee5c");
	test::eq(turbo_shake::xof(128, 32, pattern[:(int)math::pow(17, 5)]), x"b97a906fbf83ef7c812517abf3b2d0aea0c4f60318ce11cf103925127f59eecd");
	test::eq(turbo_shake::hash_128(32, pattern[:(int)math::pow(17, 6)]), x"35cd494adeded2f25239af09a7b8ef0c4d1ca4fe2d1ac370fa63216fe7b4c2b1");
	test::eq(turbo_shake::hash_128(32, x"ffffff", 0x01), x"bf323f940494e88ee1c540fe660be8a0c93f43d15ec006998462fa994eed5dab");
	test::eq(turbo_shake::hash_128(32, x"ff", 0x06), x"8ec9c66465ed0d4a6c35d13506718d687a25cb05c74cca1e42501abd83874a67");
	test::eq(turbo_shake::hash_128(32, x"ffffff", 0x07), x"b658576001cad9b1e5f399a9f77723bba05458042d68206f7252682dba3663ed");
	test::eq(turbo_shake::hash_128(32, x"ffffffffffffff", 0x0B), x"8deeaa1aec47ccee569f659c21dfa8e112db3cee37b18178b2acd805b799cc37");
	test::eq(turbo_shake::xof(128, 32, x"ff", 0x30), x"553122e2135e363c3292bed2c6421fa232bab03daa07c7d6636603286506325b");
	test::eq(turbo_shake::xof(128, 32, x"ffffff", 0x7F), x"16274cc656d44cefd422395d0f9053bda6d28e122aba15c765e5ad0e6eaf26f9");

	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 0)]), x"3e1712f928f8eaf1054632b2aa0a246ed8b0c378728f60bc970410155c28820e90cc90d8a3006aa2372c5c5ea176b0682bf22bae7467ac94f74d43d39b0482e2");
	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 1)]), x"b3bab0300e6a191fbe6137939835923578794ea54843f5011090fa2f3780a9e5cb22c59d78b40a0fbff9e672c0fbe0970bd2c845091c6044d687054da5d8e9c7");
	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 2)]), x"66b810db8e90780424c0847372fdc95710882fde31c6df75beb9d4cd9305cfcae35e7b83e8b7e6eb4b78605880116316fe2c078a09b94ad7b8213c0a738b65c0");
	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 3)]), x"c74ebc919a5b3b0dd1228185ba02d29ef442d69d3d4276a93efe0bf9a16a7dc0cd4eabadab8cd7a5edd96695f5d360abe09e2c6511a3ec397da3b76b9e1674fb");
	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 4)]), x"02cc3a8897e6f4f6ccb6fd46631b1f5207b66c6de9c7b55b2d1a23134a170afdac234eaba9a77cff88c1f020b73724618c5687b362c430b248cd38647f848a1d");
	test::eq(turbo_shake::xof(256, 64, pattern[:(int)math::pow(17, 5)]), x"add53b06543e584b5823f626996aee50fe45ed15f20243a7165485acb4aa76b4ffda75cedf6d8cdc95c332bd56f4b986b58bb17d1778bfc1b1a97545cdf4ec9f");
	test::eq(turbo_shake::hash_256(64, pattern[:(int)math::pow(17, 6)]), x"9e11bc59c24e73993c1484ec66358ef71db74aefd84e123f7800ba9c4853e02cfe701d9e6bb765a304f0dc34a4ee3ba82c410f0da70e86bfbd90ea877c2d6104");
	test::eq(turbo_shake::hash_256(64, x"ffffff", 0x01), x"d21c6fbbf587fa2282f29aea620175fb0257413af78a0b1b2a87419ce031d933ae7a4d383327a8a17641a34f8a1d1003ad7da6b72dba84bb62fef28f62f12424");
	test::eq(turbo_shake::hash_256(64, x"ff", 0x06), x"738d7b4e37d18b7f22ad1b5313e357e3dd7d07056a26a303c433fa3533455280f4f5a7d4f700efb437fe6d281405e07be32a0a972e22e63adc1b090daefe004b");
	test::eq(turbo_shake::hash_256(64, x"ffffff", 0x07), x"18b3b5b7061c2e67c1753a00e6ad7ed7ba1c906cf93efb7092eaf27fbeebb755ae6e292493c110e48d260028492b8e09b5500612b8f2578985ded5357d00ec67");
	test::eq(turbo_shake::hash_256(64, x"ffffffffffffff", 0x0B), x"bb36764951ec97e9d85f7ee9a67a7718fc005cf42556be79ce12c0bde50e5736d6632b0d0dfb202d1bbb8ffe3dd74cb00834fa756cb03471bab13a1e2c16b3c0");
	test::eq(turbo_shake::xof(256, 64, x"ff", 0x30), x"f3fe12873d34bcbb2e608779d6b70e7f86bec7e90bf113cbd4fdd0c4e2f4625e148dd7ee1a52776cf77f240514d9ccfc3b5ddab8ee255e39ee389072962c111a");
	test::eq(turbo_shake::xof(256, 64, x"ffffff", 0x7F), x"abe569c1f77ec340f02705e7d37c9ab7e155516e4a6a150021d70b6fac0bb40c069f9a9828a0d575cd99f9bae435ab1acf7ed9110ba97ce0388d074bac768776");
}

fn void turbo_shake_empty()
{
	test::eq(turbo_shake::hash_128(32, ""), x"1e415f1c5983aff2169217277d17bb538cd945a397ddec541f1ce41af2c1b74c");
	test::eq(turbo_shake::hash_128(64, ""), x"1e415f1c5983aff2169217277d17bb538cd945a397ddec541f1ce41af2c1b74c3e8ccae2a4dae56c84a04c2385c03c15e8193bdf58737363321691c05462c8df");
	test::eq(turbo_shake::hash_128(10032, "")[^32..], x"a3b9b0385900ce761f22aed548e754da10a5242d62e8c658e3f3a923a7555607"[..]);

	test::eq(turbo_shake::hash_256(64, ""), x"367a329dafea871c7802ec67f905ae13c57695dc2c6663c61035f59a18f8e7db11edc0e12e91ea60eb6b32df06dd7f002fbafabb6e13ec1cc20d995547600db0");
	test::eq(turbo_shake::hash_256(10032, "")[^32..], x"abefa11630c661269249742685ec082f207265dccf2f43534e9c61ba0c9d1d75"[..]);
}

fn void turbo_shake_simple()
{
	String[][] expected = {
		{
			x"eaca7487517a64a2cf9c16164af183dc",
			x"eaca7487517a64a2cf9c16164af183dccf94306ba071eeabd209e602cba4941610124dba2d57789844c73c1fb52af3946400e597dab46a4079001284b69ea3ab7a9e558de6cc76f79b4cc934eadbb09947ce628a3f56a70f8b227a9b4536e6e949f5ae1798612234dbe21b4fde637833b7cb7f31528d6f6506fa247df83fb8d04f6513e366edc698e181144940d58b7a6cdfaadeb11b40f344d09c003dabf9a5c6b15a2a095612a2e4e46201d3946a2d420bcab9f1af850e8cb2424558bea46c7718a04f546723985ceaff2bd31d0db1561f62293e6368f7606b0326f6ba447fb997548233e3fb91f9bf8ae6ee0dcb1d217bcc14a0ae60d564bfee2a24d29830",
			x"eb93272bb0c682328749cd9f93e8c8b3",
			x"eb93272bb0c682328749cd9f93e8c8b33569cfbf2d69584c0e98af343f4caedff17201d9273ddb654fc479583efeafb6ebca6f2dd8b41f473889042919ff484c3303abebf94c1f358619a110f16f2ee0259ffc89469871c5099c3af7264c3b976c928b7ae0ed3b83a6bdf01c537ae4ad2a40438ff1831bc50a6a849e554c25ddbcab7e3945fb54a45369d85b5ad5e9313ffded7a88af50a546432778fbb4e798a88349b20449c36848a67daa57bcf6c1c9d9163e7dc680dd9d031cf773e9c43247894e147db881b718184ba61ad1cd53631a79c751a18f5e0f2bd967c5e9c50fd9dac1560b47e84fdebdd8fa1c19f601a254b5cbfca1fd27b9d67e5841aaaee1",
		},
		{
			x"298a90e35d75c08f653fff498b259136",
			x"298a90e35d75c08f653fff498b259136e6b2dcc5b3de4e8d22eec21674c87b87ddaa6f91dbb1d5d4e16bdf891a1ae7ee7f9e9a0f7e92e679eaee7ec740d63ee319f4c327b75b113b009e132c2b5255094df72221a71aba31de1aaa7853b6d7cc8a20649b2b94222bfe3955c9c70c7815e51db40c30419e691bc9ccb665df1ea575d7516f85da0bb90ae5d039cd83f0f484da7c1de07f379ed4d7512ba080035720aa9374e37986a5c22bfb16a8faa684f9afe5538a74bfdb0f58aaab10b7511118ffa8f731ed405d063a750cac5e39fcf5d4dd73e597e733046e6671dfe03bfa7a6aa7f50ca23f020b162c7ef90e0fe262cd8b4f8d8b707e30bcc4705ab85b1e",
			x"1e05dd819d402a6b21aeefb2a7ba620b",
			x"1e05dd819d402a6b21aeefb2a7ba620b6ad6a78dd77fea9276a0fa37f7bdbc948c45ead50e17e573753d340a32ee011c30a2748df7a705e2c17df8e0053f3745d168b291cdc6dcc3629e827dabccd4996e6d494cc3f7d7a53fb2999a1b04270f44a302d1b3059ef16a6d08ff8015820280a989fd318758ce9ffd81b9f32ee3f0c2f7d2393193c244ca36b54fb45ca86f026200b4ddf139364f7a537be44f9ed76540682ee64a1fe04ba7b97f1506cdd68c97578b4a84d65fbefc8b5f41866c736904bbec45d9ec818e57d96aac6866c0b8cb8cf0cd560fdad7d61256e338a7f624c6a149b30ba0a6f736ae643252be8b2c13edb637c7d4102c1cc91815212c04",
		},
		{
			x"8d15a2be9f7c9ba3282c29b75a2bde24",
			x"8d15a2be9f7c9ba3282c29b75a2bde24342290c822e82f227f6ac43722cdc276ba6e869dbc55862aed8279d9345c2c512a2b92585de874e23d2183b0873abc47264d1cc33927bed8d8c737c5308e02869e0906ec6bd5115b9ae325561bbcc36a50b7923b39e86c58e96147b6ba98d329db4708cfbac0b7a81ed0323536d1292c3ef92ec28f956d65d246a329c660639f42dfd607db648b20e2de47f5ae2f3edc2e2c9e6d7d2ad36df84c0660da4425536eeb2db7d3873e62c75c3d97d02b2e5bddfa8ea07166643407a9db4cfdf7b2a0077fac93f934497c576ea4a512ea251ddce9ffc367c5924d4c515ca3c5e182beb95f9d3a31e4fcccb7804dd2bb95c30a",
			x"3f6d947b1e04f723d08ea955bab81df3",
			x"3f6d947b1e04f723d08ea955bab81df387e1eacc0f8f2b26b221e02b8a274936267c800e1c9b5b395d3c99921d4015d7d42038ef7ced51861924404f789476fc839feae04bb4dcb57efbf7d4c31041cfbdb9e39f56de69fcb04be089c06931795cd710d1ce62f4c27e5db59b9ad0983f91ca22ce0e71e2ff0475e41d2edb46654c742fafd892a582d57e8f5653c923a68614fec0190f3aa0f4fb267332ddc8c48c2f893db1d34dd15ac13e3e559b4f8fc6d61f061cc047547e8ea0ec4b834c01dad964abc8ca026d60dc6b1804265591d2ca290f95332c826e0bd3038ab1a5ffddf1e9cc43fffde6ef7817680e898d7836425c6bd83d54c24a198c9eb9016397",
		},
		{
			x"76a1720a4848ab64e67e563f16b8c5aa",
			x"76a1720a4848ab64e67e563f16b8c5aa492b698a4d93429735fd02354657fbf7a0689ec77b4c795fda9daab410c63092f54200846c34120ff2b253e9fd8d9fc40a2090817e60c214ebb20e1c2edfc9588474d99420765cca47f89e73ed315c6c3b982d8c1b415df7a13cad1eba112f7270e33b29c12fa2355ea2c45fb72e09386b4f32712bab7377e0e270d4a2cd3c46c1df89724ac35f8b9621a5802fdb5720495be9bf8726f5c8b815661b32ddd4b35a10eaff4834bd007cd0fccd79af227ed75e5890d8d06144d9048ab8e4e1be4e98c15480094d91f1ac1f8132bed9e7851290c4fe991bf9558fa2533c65f58729ab04176fa0a3366d20ebad2d9ca9e83f",
			x"b6e91a412c262c7936b069f67bd21c2f",
			x"b6e91a412c262c7936b069f67bd21c2f8ecc48bda8dc6eebfbaf6fcaa82191c3974462707ab2a5c5d704b0e874860a2a3fddb588f507c9b4f0417e2b6631609042be74a75d546d7652838dcfec7aa7d80d61dd455694798aa0c47927b4323d990113a977447647ac4c93560b0ba3218ad815d5d825d55395ac59113803f9a5c14142e269178670f341ad7f8529ba36d83136b42b07b50e9b2516a705d083ac38f65f04c1b048e27e065494a373f45b28f5c7f523f79a9b478289ea9bfa261580c331be147cb1cce363e03c3b7d2345dea27eb4548296b42e2ae228b84c278ac6b377ae180a5519b2494a05a013f0228a7f052c1f369c8bc2dc466972caa49453",
		},
		{
			x"3b2dadd885a11a362914bace45bf66b7",
			x"3b2dadd885a11a362914bace45bf66b7b4b9c14314b1f2ced4d28afc944390a678de267337151fe548c7bf8d11c8736d300c9f7d29c5f9a0f152eadc45f8c51274ca2f4930a0c59bd60dfc6acff6cd8503dfcd05f5d28ddda3dc5d6e22a72be32c22fe11a0592d2b2998c02cf00fd2e7a12993f9e261a1f2d95b91153252315c39e02b04fc9218048b092119bcde178d586c99a223ceede5a1c94667849499b36ad10af268d933b273e01df479c22a2bb4a5bcde8fd1dd543981bc628ec3be29792070cedbe06441833ed7a62343133d55427f5b9aaa0150a7b2d5bc7c338fd61e77cad600abe746c0a42fe4dae88e5b24bc0da188c45548f77b7d03575c70d2",
			x"445ae815c43a7c8c108056a2f859cb01",
			x"445ae815c43a7c8c108056a2f859cb014268ab37aa16e5458fffb37194e7bfc6ab3febb95f2c92b0f9f77797b47698378ed5c0a8ba92cf6e989faa0ca0cce928e824b238f9782aaa85e3c92fa346ef40da236bb0f66ea2adf8fc571925dfcc9257c1da937b4c0dc4e0e49750897417c180144cad280bbe33dc8c402c60303fc3a32b24be117a9b4ec90869c606caef9e4c1c3f349d9d261f1dbc5884529ae930d988b0ba2d525ace8892b1a1a2fbcfb2ef577070ed0cc2b291a51580c08dbc5667485d28e243cfc04ae6328e8268570f8a637af9833e4336a17b205f24275c93d288e399b159aa76d5bcf60dd2b52b29507c45219cc39574dc8958bb9a1e14dd",
		},
	};

	foreach (i, v : tests_common::SIMPLE_VECTORS)
	{
		test::@check(turbo_shake::hash_128(16, v)[..]  == expected[i][0], `128(16): Failed on vector "%s".`, v);
		test::@check(turbo_shake::hash_128(256, v)[..] == expected[i][1], `128(256): Failed on vector "%s".`, v);
		test::@check(turbo_shake::hash_256(16, v)[..]  == expected[i][2], `256(16): Failed on vector "%s".`, v);
		test::@check(turbo_shake::hash_256(256, v)[..] == expected[i][3], `256(256): Failed on vector "%s".`, v);
	}
}

fn void turbo_shake_interval()
{
	char[257] x = { [0..256] = 'a' };

	String[][] expected = {
		{
			x"8aa4dde8bc0909d54abf2b695607d434",
			x"8aa4dde8bc0909d54abf2b695607d434d0b1fd2f64bee5e2aa26bea9c466036fb1a241f665bce6a6f27bb779dc2385c8d7f320e95c1c05602c406973b1077c17fb46c8297d038eae9156492b5d44d324bc6772d927cc3ef8c5779258e486dc7f1225b781dfd3a0a0efa03043d2a3e7079ac00ab0a75d8dbd94a1d600c504a09c9a0f2038737838f157e2ff306fb11c10ef434d9c4689651281d65a65a1f537fb1b7aa15a5ffbfc7ae6b83e11e3cec97882dd63fb519c805246a0d00a2a3bef4f50898e8100f2ebb72cee3bfc3ef553af2bb472eda8985546c816dc3d66831db8e1f87eaa5a6d3638b9236d4e86e6362b2bf43500162c6c7b80556f50179ab629",
			x"4e2722807d3e08e2ced96f6d08aeb47a",
			x"4e2722807d3e08e2ced96f6d08aeb47a8ea3c11cce47bba51bf7ad892b43d426631dcc92856cef7954d19986dbc5efcec488427c32300c5588b704704d4bed0397cba4273101cb5f44cd1c4fb14dce46d30e18bc0a976afaed80923ae9ede6dc43c106959c725fcc6785c4480c50ce9e7724b00e45a3cb31d3982a294542b53507308084a7310eaf59d7592d7da4bb048e6e894cd2514f63558c17188da8a0a5c025ab1b861cce11a5cd400b1a244eed80374b1f79f04fc65ba7ebb180140e565f621155ca618c7819b57caa95ceff6ad1f296ddff4d58b4883e8cac9d2d9c23d443238d4bc905609cb21b3db1c099918b72646401ac55d1151d567341ddcc90",
		},
		{
			x"9271c06880af9517aeaa62944dcc0b46",
			x"9271c06880af9517aeaa62944dcc0b463bd224aaf313d468563670bdc943b982c7598c82cf1060e9fcdcc3ec4535b51e0875a98f4e137cc81607b2968e211b6e0ef8f48ec958767d3624b1c8c96fe165ec576a5993e242f9c77cf866a231f87b47aa8f513ce8182677874d01e6b2b25940a72b4002e0f9e8b6c225f53791fcc38590a292f2f38f9cf485fdb08cee1bab3d1c87c28f432edd57027b32a4650a423c5ff139263e9b804e897d72befb4e37e5cbbae6720d1d4d6664491be9cbbe14ad2bde98e28b48e6bdd875f9c5a30f3769501befeae7e84a00536bbb5ae0247574f40d2df4bc53ee43763132bedbf408003ef677129eac3a22568d02bedca475",
			x"058e623c4a8f4c647f887ae4f06f9cf5",
			x"058e623c4a8f4c647f887ae4f06f9cf5784c16f7e2d47ede6eb983be8a8fe88d1ba9b67090600067c9349bcc0f7e1e55f51e74457e71e62463c995fe28076bc1d134ae248241787650c368553a13b370fb6aa177e1ab079ef36c9f88d3135d7f984434d736634c2d76095b4912e205f5314ccfe5c2405907d05f1991c7738845b460b95a5a6367c1723a3c681fc378862e777b552dc05c86e4bc48764e5ba39937c99e5915079e39446f57d1f432836410ed5557c9de39f57ac0aeb5b1b4dc471657c8babe58408dc5f159a50e8494effb47465ab9ac73ff7815b2a6df68caed73926c4fcf17bf049ba189d26c089a23e75940cc4d88c932e985ea5417c7045d",
		},
		{
			x"edf867c9e86d520017a23007055c278f",
			x"edf867c9e86d520017a23007055c278f0f91f407251d5843a05a1878a290f91e5cc94a368c6cf78a5b2515d70e567b961b25e5f91f9ca238596de3acf08301ac504ca9a103ac894dbe8c02175e74ea7ddd5b3d8f88e94d0c34d2d053d55ba263c9885b35dbc3497b0cd743a07c32ae30b157f8de8c4fe045cf40fefaf85c41d1877b0902ba18a9eab4942de52a556dee7a7963029bea60c55297399181a43c58898c63fd3deeb1a5646076e89f3c314111db846a9e65920656b1adebf5ed0059ba3bba9ee844212304c1a83c9f53ef606d943faf851b04885b827b3654891815fcde479f2778ad48a82275bb42427acd13a113c68b4e26c5e2e39549e38dd108",
			x"e1605da9332adcdc9afba16a344c5a55",
			x"e1605da9332adcdc9afba16a344c5a553fc3659df730705f708032c7e732ab105388d3feaf402dad174867726345fb1c8e4d7260604525780ec5163a7c61b94d23af6cb3ff9bc544b456e9107ee6b3a224dd7317ff2d818cea5db7013674b544cad5a470b1884a1c3f44c4fbb2201c63e2d2348aa2c3d1090979ecd87e24a23e7665f8f0dab0baf776a92a943daa94eaa151fb62dc36e1ce2fe84ea29a7a2d13290eae271c0642258ae082286984cbca0800de5303e02feff25d43b3582f62e83b5c74c2ac79e782fb31773ee802c70b37f12484013c70a8ed33998def6038d51db0b7750606c5d6e3a013e6f80d4759cc23cb06d9cc7fde34c05e64df27096e",
		},
		{
			x"29db6112c158eb628603ec2adb7d6e47",
			x"29db6112c158eb628603ec2adb7d6e47bfab2e3ff866a095d84cda211cc7b8ec36c2ce8d4617aad4d3b1b8566e8b852bab5af934846f97ed822ea7bb2db20043b4a32b7dcafd34a125b79afab5b99ca5ca20af5fa42c5eb0fb9ab19b66f2e09f1d52abd2d8e687c6d6beae76af168e897adb785797c86f6380b9ed9dc05a457591a8a2cb2b1aaf71105f179a620b3ed234168295d1b79b1f2bce0efee1b1cdea28043a126673fcdc60032f2daf061aa35a904408729f92f35b32a6a0e10db3e2272e8018293fed5472eda2f9690580f106f245ea6dd9ddd9a31de0903eb790fc5e24e6801f664a603f52d974f6e61d6b5354d3c9b6bf3f1636aad67042c53998",
			x"275b7c60715f4fe4a19b6cd7b68ccc4f",
			x"275b7c60715f4fe4a19b6cd7b68ccc4fed81cf94ed05de187d0ce296bde0f288bcbffb27cb22655c61504316ed54fb3dde57ce25141c4462d3b2135c0c7dfbe6da993606bb8abd99965fb80f000c65ede68f5e5600305bc23067ab4c7d3cedfca666573d0d3d55c2081c4af33898ed00d4b67bdf9f97139879722d34b9e32c1cd73ad174ed52c711fe0ff7a6119edb005292fa3d68dd10cfb94f4413b379c423571b00eaf6417cd109bfe8e80c1c6375aa53bd986d7af8ca563e3d6df6d3fcb15f04235b591fbd4b381d4120e0a95344ef3ec6952ce3beab19ed4da925309fd5ab293e1c9a94b4206c553ff6576ef85b4875f30ebdec1a55f070c0fcf34f6370",
		},
		{
			x"a3153a38f430e55c99296c7465c21ee2",
			x"a3153a38f430e55c99296c7465c21ee202d06016dbdcdb79a7abab946ab30e2132e4aea4ee45b24cbbf9d1afdf30586017266d4639dc96f018ca78b1fce4925e2fabb377f31d0b3816e4b7dc027a2785d132142399acbb692661173728ec8485bfec254a9de73fa66ec91740c234a10c8c42165ba3f83e9e0dd3d1254d67e0e62851e1b1c08350f4ff6e1db7889b1325d2a27b18cc01d9ccf98b00c7b90a24bdd431d96197428b1a90014cab0d05fb8685fc25b28d0088b23c65cda3e6d61c4794fbad8862672bdba118deff6b9af2bf395c80e7c146ef986acb4cdaa72625e327fe6af7fa62fd6317b23e83ed6a51d2d46e6bffc5324c36a4d7ad10344438de",
			x"b02e7523ddffcb5e7353bdae4c10b500",
			x"b02e7523ddffcb5e7353bdae4c10b50054e33540d571a5d01d35725ae6c70ef0df108cd84f2297bbe316addce63b85cc94144c8ef0c09b90545bd032e1d6dde4f92cf8803df1ad833cc84a9356f6e1fc516a07da64e2b6fdbc450ca5a351689cc79720075da5fa5e566ac787e3debaa11c8fdc13e940e2c36049db85db30ea0e36dfbd004df57cf1043fb1efc869e09d20722cabea9f81e12e6860f7a19a4cbdc793cbcb62639a46efedd97868ac2dc7ce9e87b3af0a4c4fa04f11501c3beb3bbc7580e8f81be997b61394b5dd8dd14a1099118ff9286c66117727e6f4edc5ac395ccc95ab2dad309b14931b1647efbfef65fea2f44b47c04fd751735c02ee45",
		},
	};

	// 'a'-array of lengths [1, 65, 129, 193, 257]
	for (usz i = 1, usz j = 0; i <= 257; i += 64, ++j)
	{
		test::@check(turbo_shake::hash_128(16, x[:i])[..]  == expected[j][0], "128(16): Failed on length %d.", i);
		test::@check(turbo_shake::hash_128(256, x[:i])[..] == expected[j][1], "128(256): Failed on length %d.", i);
		test::@check(turbo_shake::hash_256(16, x[:i])[..]  == expected[j][2], "256(16): Failed on length %d.", i);
		test::@check(turbo_shake::hash_256(256, x[:i])[..] == expected[j][3], "256(256): Failed on length %d.", i);
	}
}

fn void turbo_shake_streamed()
{
	String s = tests_common::STREAM_VECTOR;

	TurboShake128 s1; s1.init();
	TurboShake128 s2; s2.init();
	TurboShake256 s3; s3.init();
	TurboShake256 s4; s4.init();

	s1.update(s[:20]); s1.update(s[20:10]); s1.update(s[30:1]); s1.update(s[31..]); 
	s2.update(s[:20]); s2.update(s[20:10]); s2.update(s[30:1]); s2.update(s[31..]); 
	s3.update(s[:20]); s3.update(s[20:10]); s3.update(s[30:1]); s3.update(s[31..]); 
	s4.update(s[:20]); s4.update(s[20:10]); s4.update(s[30:1]); s4.update(s[31..]); 

	char[16]  s1_hash; s1.final(s1_hash[..]);
	char[256] s2_hash; s2.final(s2_hash[..]);
	char[16]  s3_hash; s3.final(s3_hash[..]);
	char[256] s4_hash; s4.final(s4_hash[..]);

	test::eq(s1_hash, x"3bc853f73a1d55518b1e975369612671");
	test::eq(s2_hash, x"3bc853f73a1d55518b1e97536961267188a1f96d289ea1298c2ee4a313af20834dff2fb560ab5f8f0e659a650e54a05dd93094be40780bdf4806ee8d0132fdbe06f0b3048015badd32077366620ad2d972db87a38d81db1dc0e4066062edfa7b0a4a229d35709b9b2a8faf95531d0d49665f4086d4ae7d331f2a8ca4a5a669f79955773d239e4edbd97a8d60c603c973c1d01d28f8e41386bd5b69598d9d643aa7859b243b17cb64c9038261e7afe4789d43572e48f819f64be6172b6c06551fbc3343aac6e1c7f7b8eab87fcefbf30058e720f82e92cfa2c5da9995dba6b7468066de120d0334116aa617710c78c36e347a47d350887a922f71441006c926d5");
	test::eq(s3_hash, x"0026d33cebc52b84029441e9756e1fb7");
	test::eq(s4_hash, x"0026d33cebc52b84029441e9756e1fb7b1ff53268178f91f9b0e725b1517443a2d674eaf8b5be9b64bcc724eef6d365db378a078b1d99640afa4c4e2e24ee46506eb485f1dfc5c56827dd03b0ad9e2a36c2488143a92fc11c6b093982563471f6dbc0bd026e99ab61b7224331cad7aef307647b58dedaab83c461f78fc391e8b3e1921f5658d9afe962c385a9613aa04b94a68887a343a790a1e6b41be5c0772f5d6e82c6e458fe955dc7c724e57fcbb936cfd90e495b8588d9fa48d326c3ce535098370efdad46bf970a6c64511021d77e7def3f69db28d8763c95d85a2c0823a30c16d1fcd6efabd79422679dbca2382c2c7804142a46b110f3273db458428");
}

fn void turbo_shake_large() @if($feature(SLOW_TESTS)) => @pool()
{
	char[] bigboi = tests_common::get_bigboi();

	String[] expected = {
		x"23e830becad5b5c1c99f3df30224800c",
		x"23e830becad5b5c1c99f3df30224800c85e9a2e47199a58a51017d9f5aa6662419c2fb31904a5a308fee216e340f0b07064ad2e027ce33efcdc40e725cb2deea4d95538c9ae98c9cfa8c4332c24237eb7b34692f2048028271ce0d5cc4bb414d0e0b1b619560f7538f098ebdb91c2b9f95f59e629a6a508ac99457ced7d31734ce4d732282a5cfb3077a404113266f94ca8f669da6a3fb46ac7c6e4549ed75c1d9319ea450be8969a8057f3c6f161db342d04bfc71f8ba827beeb9d307e2edb474e49b228b16ff3853f4e6abc5eff6bfc79e1d0373644f67747f191ffca88550526d9abee348e3ef03e4fabe1e5a7f72a3a3a800edc3d2605010dcc6f94b41ec",
		x"96a325530bc118376f6e1fdfe84781b9",
		x"96a325530bc118376f6e1fdfe84781b9a3d98ebe34fb3decaedf89a138e0e2ed8265dada48ce4252e2908d3bb84b5822043fbbb2ab3f486444aed22038ac770fab149347d6a41619119b246476397797719e2b9667c0d5d6a3bb679acf5d3abbba396f1114f11316d54d90cf4193a942ad7f7cd7acd8064ad95dc5b639c4bd52fabfa18983769dc6f73bb45e4b9325bf08dd4b73f16658d9bf0844617771b5660647fa971c4ee83a3a13ed96f00d616651270eb54a07efff26fce346bf02593707bedc7166220dc71940ebf855ce84041f2d3ae97d3a387f9c5b61b563596ae1af12e77b745fd10ceda7d02d32478da38fc694b2f1118b773a69e340d280985a",
	};

	test::eq(turbo_shake::xof(128, 16,  bigboi[..])[..], expected[0]);
	test::eq(turbo_shake::xof(128, 256, bigboi[..])[..], expected[1]);
	test::eq(turbo_shake::xof(256, 16,  bigboi[..])[..], expected[2]);
	test::eq(turbo_shake::xof(256, 256, bigboi[..])[..], expected[3]);
}
